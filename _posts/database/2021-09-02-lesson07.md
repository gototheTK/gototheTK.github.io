---
title: "데이터베이스 언어 SQL"
excerpt: "데이터베이스 언어 SQL"
layout: single
classes: wide
permalink: /database/lesson07
categories:
  - database
  - database language
tags:
  - database
  - database language
author_profile: false
sidebar:
  nav: database
---

## SQL의 역할을 이해하고, 이를 기능별로 분류해본다.

> SQL은 관계 데이터베이스를 위한 표준 데이터 언어 또는 표준 질의어이다. 여기서 질의어란 데이터 언어 중 검색 위주의 기능을 하는 비절차적 데이터 조작어를 의미한다. 그러나 SQL은 데이터 조작 기능과 정의 및 제어 기능까지 제공한다.

    데이터 정의어(DDL) : 테이블을 생성하고 변경 * 제거하는 기능을 제공한다.
    데이터 조작어(DML) : 테이블에 새 데이터를 삽입하거나, 테이블에 저장된 데이터를 수정, 삭제, 검색하는 기능을 제공한다.
    데이터 제어어(DCL) : 보안을 위해 데이터에 대한 접근 및 사용 권하을 사용자별로 부여하거나 취소하는 기능을 하는 언어다. 데이터베이스 관리자가 주로 사용한다.

## SQL의 데이터 정의 기능을 예제를 통해 익힌다.

    INT,INTEGER: 정수
    SAMLLINT: INT보다 작은 정수
    CHAR(n) or CHARACTER(n): 길이 n이 고정길이의 문자열
    VARCHAR(n) or CHARACTER VARYING(n): 최대 길이가 n인 가변 길이의 문자열
    NUMERIC(p, s) or DECIMAL : 고정 소수점 실수, p는 소수점을 제외한 전체 숫자의 길이고, s는 소수점 이하 숫자의 길이
    FLOAT(n) : 길이가 n인 부동 소수점 길이
    REAL : 부동 소수점 실수
    DATETIME or DATE : 년, 월 일로 표현되는 날짜
    TIME : 시, 분, 초로 표현되는 시간
    '' : 문자열을 표시하고 대소문자를 구분

    1. 테이블 생성(CREATE TABLE)

        CREATE TABLE 테이블_이름 (
            속성_이름 데이터_타입 [NOT NULL] [DEFAULT 기본_값]
            [PRIMARY KEY (속성_리스트)]
            [UNIQUE (속성_리스트)]
            [FOREIGN KEY (속성_리스트) REFERENCES 테이블_이름(속성_리스트)]
            [ON DELETE 옵션] [ON UPDATE 옵션]
            [CONSTRAINT 이름] [CHECK(조건)]
        )

        1. ON DELETE NO ACTION : 투플을 삭제하지 못하게함
        2. ON DELETE CASCADE : 관련 투플을 함께 삭제함
        3. ON DELETE SET NULL : 관련 투플의 외래키 값을 NULL로 변경함
        4. ON DELETE SET DEFAULT : 관련 투플의 값을 미리 지정한 기본 값으로 변경함

        예제1) 고객 테이블은 고객아이디, 고객이름, 나이, 직업, 적립금 속성으로 구성하고, 고객아이디 속성이 기본키다. 고객이름과 등급 속성은 값을 반드시 입력해야 하고, 적립금 속성은 값을 입력하지 않으면 0이 기본으로 입력되도록 고객 테이블을 생성해보자.
        CREATE TABLE 고객(
            고객아이디 VARCHAR2(20) NOT NULL,
            고객이름 VARCHAR2(20) NOT NULL,
            나이 INTEGER DEFAULT 0,
            등급 VARCHAR2(20) NOT NULL,
            직업 VARCHAR2(20),
            적립금 INTEGER,
            PRIMARY KEY (고객아이디)
        )

        예제2) 제품 테이블은 제품번호, 제품명, 재고량, 단가, 제고업체 속성으로 구성되고, 제품번호 속성이 기본키다. 재고량이 항상 0개 이상 10000개 이하를 유지하도록 제품 테이블을 생성해보자.

        CREATE TABLE 제품(
            제품번호 CHAR(3) NOT NULL,
            제품명 VARCHAR(20),
            재고량 INTEGER,
            단가 INTEGER,
            제조업체 VARCHAR(20),
            PRIMARY KEY(제품번호),
            CHECK (재고량 >= 0 AND 재고량 <= 10000)
        );

        예제3) 주문 테이블은 주문번호, 주문고객, 주문제품, 수량, 배송지, 주문일자 속성으로 구성되고, 주문번호 속성이 기본키다. 주문고객 속성이 고객 테이블의 고객아이디 속성을 참조하는 외래키이고, 주문제품 속성이 제품 테이블의 제품번호 속성을 참조하는 외래키가 되도록 주문 테이블을 생성해보자.

        CREATE TABLE 주문 (
            주문번호 VARCHAR(20) NOT NULL,
            주문고객 VARCHAR(20),
            주문제품 VARCHAR(20),
            수량 INTEGER,
            배송지 VARCHAR(20),
            주문일자 DATE
            PRIMARY KEY(주문번호),
            FOREGIN KEY(주문고객) REFERENCE 고객(고객아이디),
            FOREGIN KEY(주문제품) REFERENCE 제품(제품번호)
        );

    2. 테이블 변경(ALTER TABLE)

        2.1. 새로운 속성의 추가

        ALTER TABLE 테이블_이름
            ADD 속성_이름 데이터_타입 [NOT NULL] [DEFAULT 기본_값];

            예제7) 예제1)에서 생성한 고객 테이블에 가입날짜 속성을 추가해보자.

                ALTER TABLE 고객 ADD 가입날짜 DATETIME;

        2.2 기존 속성의 삭제

        ALTER TABLE 테이블_이름
            DROP 속성_이름 CASCADE | RESTRICT;

            예제8) 예제1)에서 생성한 고객 테이블의 등급 속성을 삭제하면서 관련된 제약조건이나 등급 속성을 참조하는 다른 속성도 함께 삭제해보자.

                ALTER TABLE 고객 DROP 등급 CASCADE;

        2.3 새로운 제약조건의 추가

            ALTER TABLE 테이블_이름 ADD CONSTRAINT 제약조건_이름 제약조건_내용;

            예제9) 고객 테이블에 20세 이상의 고객만 가입할 수 있다는 데이터 무결성 제약조건을 추가해보자.

                ALTER TABLE 고객 ADD CONSTRAINT CHK_AGE (나이>=20);

        2.4 기존 제약조건의 삭제

            ALTER TABLE 테이블_이름 DROP CONSTRAINT 제약조건_이름;

            예제9) 고객 테이블에 20세 이상의 고객만 가입할 수 있다는 데이터 무결성 제약조건을 삭제해보자.

                ALTER TABLE 고객 DROP CONSTRAINT CHK_AGE;

    3. 테이블 제거(DROP TABLE)

        DROP TABLE 테이블 CASCADE | RESTRICT;

        예제10) 고객 테이블을 삭제하되, 고객 테이블을 참조하는 다른 테이블이 존재하면 삭제가 수행되지 않도록 해보자.

            DROP TABLE 고객 RESTRICT;

## SQL의 데이터 조작 기능을 예제를 통해 익힌다.

    SQL의 데이터 조작 기능은 원하는 데이터 검색, 새로운 데이터 삽입, 데이터 수정, 데이터 삭제로 분류할 수 있다.

    SELECT [ALL |DISTINCT] 속성 리스트
    FROM 테이블_리스트
    [ WHERE 조건 ];

    예제 7-9)
        고객 테이블에서 고객아이디, 고객이름, 등급 속성을 검색해보자.
            SELECT 고객아이디, 고객이름, 등급, FROM 고객;

    예제 7-10)
        고객 테이블에 존재하는 모든 속성을 검색해보자.
            SELECT 고객아이디, 고객이름, 나이, 등급, 직업, 적립금
            FROM 고객;

    예제 7-21)
        고객 테이블에서 성이 김씨인 고객의 고객이름, 나이, 등급, 적립금을 검색해보자.
            SELECT 고객이름, 나이, 등급, 적립금 FROM 고객 LIKE '김%';

    예제 7-22)
        고객 테이블에서 고객아이디가 5자인 고객의 고객아이디, 고객이름, 등급을 검색해보자.
            SELECT 고객아이디, 고객이름, 등급 FROM 고객;

    예쩨 7-23)
        고객 테이블에서 나이가 아직 입력되지 않은 고객의 고객이름을 검색해보자.
            SELECT 고객이름 FROM 고객 WHERE 나이 IS NULL;

    예제 7-24)
        고객 테이블에서 나이가 아직 입력되지 않은 고객의 고객이름을 검색해보자.
            SELECT 고객이름 FROM 고객 WHERE 나이 IS NULL;

    예제 7-25)
        고객 테이블에서 나이가 이미 입력된 고객의 고객이름을 검색해보자.
            SELECT 고객이름 FROM 고객 WHERE 나이 IS NOT NULL;

    예제 7-25)
        고객 테이블에서 고객이름, 등급, 나이를 검색하되, 나이를 기준으로 내림차순 정렬해보자.
            SELECT 고객이름, 등급, 나이 FROM 고객 ODER BY 나이 DESC;

    예제 7-26)
        주문 테이블에서 수량이 10개 이상인 주문의 주문고객, 주문제품, 수량, 주문일자를 검색해보자. 단, 주문제품을 기준으로 오름차순 정렬하고, 동일 제품은 수량을 기준으로 내림차순 정렬해보자.
            SELECT 주문고객, 주문제품, 수량, 주문일자 WHERE 수량 >= 10 ORDER BY 주문제품 ASC, 수량 DESC.

    집계함수
        열 함수(COLUMN FUNCTION)라고도 하며, 개수, 합계, 평균, 최댓값, 최솟값의 계산 기능을 제공한다.
            COUNT : 속성 값의 개수 (모든 데이터)
            MAX : 속성 값의 최댓값 (모든 데이터)
            MIN : 속성 값의 최솟값 (모든 데이터)
            SUM : 속성 값의 합계 (숫자 데이터)
            AVG : 속송 값의 평균 (숫자 데이터)
        집계 함수는 NULL값을 제외하고, WHERE절에서는 사용할 수 없다. SELECT 절이나 HAVING 절에서만 사용이 가능하다.

    예제) 한빛제과에서 제조한 제품의 재고량 합계를 제품 테이블에서 검색해보자.
        SLEECT SUM(재고량) AS '재고량의 합계' FROM 한빛제과

    예제) 고객 테이블에 고객이 몇 명 등록되어 있는지 검색해보자.
        SELECT COUNT(고객아이디) FROM 고객;

    그룹별 검색
        SELECT |ALL|DISTINCT| 속성리스트
        FROM 테이블_리스트
        [WHERE 조건]
        [GROUP BY 속성_리스트|HAVING 조건]
        [ORDER BY 속성_리스트|ASC|DESC]

    예제) 주문 테이블에서 주문제품별 수량의 합계를 검색해보자.
        SELECT SUM(수량) FROM 주문;

    예제) 제품 테이블에서 제조업체별로 제조한 제품의 개수와 제품 중 가장 비싼 단가를 검색하되, 제품의 개수는 제품수라는 이름으로 출력하고 가장 비싼 단가는 최고가라는 이름으로 출력해보자.
        SELECT 제조업체, COUNT(*) AS 제품수, MAX(단가) AS 최고가
        FROM 제품
        GROUP BY 제조업체;

    예제) 제품 테이블에서 제품을 3개이상 제조한 제조업체별로 제품의 개수와, 제품 중 가장 비싼 단가를 검색해보자.
        SELECT 제조업체 ,COUNT(*) AS 제품의 개수, MAX(단가) AS 최고 단가 FROM 제품 GROUP BY 제조업체 HAVING COUNT(제조업체) >= 3;

    예제) 고객 테이블에서 적립금 평균이 1000원 이상인 등급에 대해 등급별 고객 수와 적립금 평균을 검색해보자.
        SELECT 등급, COUNT(고객), AVG(적립금) AS 적립금평균 GROUP BY 등급 HAVING 1000 > AVG(적립금);

    예제) 주문 테이블에서 각 주문고객이 주문한 제품의 총주문수량을 주문제품별로 검색해보자.

        SELECT 주문제품,주문고객, SUM(*) AS 총 주문수량 GROUP BY 주문제품;

    조인 검색
        여러 테이블을 연결하여 데이터를 검색하는 방법을 조인 검색이라고한다.

    예제1) 주문 데이터베이스에서 banana 고객이 주문한 제품의 이름을 검색해보자.
        SELECT 주문.제품이름 FROM 주문, 고객 WHERE 판매.제품번호 = 주문.제품번호;

    예제2) 판매 데이터베이스에서 나이가 30세  이상의 고객이 주문한 제품의 주문제품과 주문일자를 검색해보자.
        SELECT 주문.주문제품, 주문.주문일자 FROM 주문, 고객 WHERE 고객.나이 >= 30 AND 주문.고객아이디 = 고객.고객아이디;

    예제3) 판매 데이터베이스에서 고명석 고객이 주문한 제품의 제품명을 검색해보자.
        SELECT P.제품명 FROM 고객 C, 제품 P, 주문 O WHERE C.고객이름 = '고명석' AND C.고객아이디 = O.고객아이디 AND O.주문제품 = P.제품번호;


    - 조건에서 NULL은 FALSE이다. 그리고 오름차순에서는 마지막, 내림차순에서는 맨처음 등장한다.
    - 그룹별로 검색할 때는 집계 함수나 GROUP BY 절에 있는 속성 외의 속성은 SELECT 절에 사용 할 수 없다.

## 뷰의 개념과 장점을 이해한다.

## 삽입 SQL의 역할을 이해한다.
